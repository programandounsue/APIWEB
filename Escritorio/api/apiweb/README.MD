package com.api.app.controller;

import com.api.app.model.Cita;
import org.springframework.core.io.ClassPathResource;
import org.springframework.web.bind.annotation.*;
import org.springframework.http.ResponseEntity;
import org.springframework.http.HttpStatus;
import org.springframework.util.StreamUtils;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;

import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

@RestController
@RequestMapping("/")
@Tag(name = "Citas API", description = "API para gestionar citas m√©dicas y autenticaci√≥n de usuarios")
public class Controller {

    private List<Cita> citas = new ArrayList<>();
    private Long contadorId = 1L;

    /**
     * Sirve el archivo HTML de la p√°gina de inicio.
     * @return HTML de la p√°gina de inicio.
     * @throws IOException Si hay un error al leer el archivo.
     */
    @GetMapping
    @Operation(summary = "Obtener la p√°gina de inicio", description = "Devuelve el HTML de la p√°gina de inicio.")
    public ResponseEntity<String> home() throws IOException {
        ClassPathResource resource = new ClassPathResource("static/index.html");
        String html = new String(StreamUtils.copyToByteArray(resource.getInputStream()), StandardCharsets.UTF_8);
        return new ResponseEntity<>(html, HttpStatus.OK);
    }

    /**
     * Crea una nueva cita m√©dica.
     * @param cita Objeto de tipo Cita.
     * @return La cita creada.
     */
    @PostMapping("/citas")
    @Operation(summary = "Crear cita m√©dica", description = "Registra una nueva cita m√©dica.")
    public Cita crearCita(@RequestBody Cita cita) {
        cita.setId(contadorId++);
        citas.add(cita);
        return cita;
    }

    /**
     * Obtiene todas las citas m√©dicas registradas.
     * @return Lista de citas.
     */
    @GetMapping("/citas")
    @Operation(summary = "Obtener todas las citas", description = "Devuelve una lista de todas las citas m√©dicas registradas.")
    public List<Cita> obtenerCitas() {
        return citas;
    }

    /**
     * Obtiene una cita m√©dica por su ID.
     * @param id Identificador de la cita.
     * @return Objeto de tipo Cita o null si no se encuentra.
     */
    @GetMapping("/citas/{id}")
    @Operation(summary = "Obtener una cita por ID", description = "Devuelve una cita m√©dica espec√≠fica mediante su ID.")
    public Cita obtenerCita(@PathVariable Long id) {
        return citas.stream().filter(c -> c.getId().equals(id)).findFirst().orElse(null);
    }

    /**
     * Actualiza los datos de una cita m√©dica.
     * @param id ID de la cita a actualizar.
     * @param nuevaCita Nuevos datos de la cita.
     * @return Cita actualizada o null si no se encuentra.
     */
    @PutMapping("/citas/{id}")
    @Operation(summary = "Actualizar cita m√©dica", description = "Modifica los datos de una cita m√©dica existente.")
    public Cita actualizarCita(@PathVariable Long id, @RequestBody Cita nuevaCita) {
        Optional<Cita> citaExistente = citas.stream().filter(c -> c.getId().equals(id)).findFirst();
        if (citaExistente.isPresent()) {
            Cita cita = citaExistente.get();
            cita.setPaciente(nuevaCita.getPaciente());
            cita.setFechaHora(nuevaCita.getFechaHora());
            cita.setMotivo(nuevaCita.getMotivo());
            return cita;
        }
        return null;
    }

    /**
     * Elimina una cita m√©dica por su ID.
     * @param id ID de la cita a eliminar.
     * @return Mensaje de confirmaci√≥n.
     */
    @DeleteMapping("/citas/{id}")
    @Operation(summary = "Eliminar cita m√©dica", description = "Borra una cita m√©dica seg√∫n su ID.")
    public String eliminarCita(@PathVariable Long id) {
        if (citas.removeIf(c -> c.getId().equals(id))) {
            return "Cita eliminada";
        }
        return "Cita no encontrada";
    }

    private static final String USUARIO_VALIDO = "MASTER";
    private static final String CONTRASE√ëA_VALIDA = "0000";

    /**
     * Autenticaci√≥n de usuario.
     * @param usuario Nombre de usuario.
     * @param contrase√±a Contrase√±a del usuario.
     * @return Mensaje de autenticaci√≥n exitosa o error.
     */
    @PostMapping("/auth/login")
    @Operation(summary = "Autenticaci√≥n de usuario", description = "Permite iniciar sesi√≥n con credenciales v√°lidas.")
    public ResponseEntity<String> login(@RequestParam String usuario, @RequestParam String contrase√±a) {
        if (USUARIO_VALIDO.equals(usuario) && CONTRASE√ëA_VALIDA.equals(contrase√±a)) {
            return ResponseEntity.ok("Autenticado");
        } else {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("Error: Usuario o contrase√±a incorrectos");
        }
    }
}




# Proyecto: API de Gesti√≥n de Citas M√©dicas

## Descripci√≥n
Esta API permite gestionar citas m√©dicas a trav√©s de operaciones REST. Incluye funcionalidades para autenticaci√≥n de usuarios, creaci√≥n, consulta, actualizaci√≥n y eliminaci√≥n de citas m√©dicas.

## Tecnolog√≠as Utilizadas
- **Java 17**
- **Spring Boot 3**
- **Maven**


## Instalaci√≥n y Ejecuci√≥n
### 1. Clonar el repositorio
```bash
git clone <https://github.com/programandounsue/APIWEB.git>
cd APIWEB
```

### 2. Construir y ejecutar el proyecto
```bash
mvn spring-boot:run
```

El servidor se ejecutar√° en `http://localhost:8080`

## Documentaci√≥n de la API
Swagger est√° disponible en:
## `http://localhost:8080/swagger-ui.html`


## Endpoints Principales
## M√©todo | Endpoint | Descripci√≥n 

## POST    `/auth/login`  Iniciar sesi√≥n 


## Versionamiento
Este proyecto est√° versionado utilizando **Git**. Enlace al repositorio:  
üîó **[Repositorio en GitHub](<https://github.com/programandounsue/APIWEB.git>)**

## Autor
- **ARLEY TORRES APRENDIS A INGENIERO**

---



